5分

# 数据库模式

- 外模式
- 概念模式
- 内模式



关系表类型

- 基本关系
- 查询表
- 视图表



# 分布式数据库

全局：

- 全局外模式

  最终被用户看到的

- 全局概念模式

  数据的整体逻辑结构

- 分片模式

  数据如何切割

- 分布模式

  数据如何放置

局部：

- 局部概念模式

  局部数据库的库表

- 局部内模式

  存放在哪里

- 局部数据库



## 数据分片

- 分片透明性

- 复制透明性

  用户不用关心数据库在网络中各个节点的复制情况

- 位置透明性

- 局部映像模型透明性（逻辑透明）

  提供数据到局部数据库的映像



**2PC 事务提交的两个阶段**

**表决阶段**，目标是形成一个共同的决定

**执行阶段**，目标是实现这个协调者的决定



**两条全局提交规则**

只要有一个参与者撤销事务，协调者就必须做出全局撤销决定

只有所有参与者都同意提交事务，协调者才能做出全局提交决定



# 数据库设计过程

1. 需求分析

   数据流图、数据字典、需求说明书

2. 概念结构设计

   ER模型

3. 逻辑结构设计

   转换规则、规范化理论

4. 物理设计

   硬件、OS特性



## 数据模型

数据模型三要素

数据结构、数据操作、数据的约束条件



- 层次模型
- 网状模型
- 面向对象模型
- 关系模型



## 完整性约束

**实体完整性**：规定基本关系的主属性不能取空值**主键**

**参照完整性**：关系与关系间的引用，**外键**

**用户自定义完整性约束**：应用环境决定



## 逻辑结构设计

一个实体型必须转换为一个关系模式

- 一对一

  可以并入任意一端

- 一对多

  并入多端

- 多对多

  不能做归并

```mermaid
graph LR

A[一对一] ----> D[并入实体]
A[一对一] ----> F[独立关系]

B[一对多] ----> D[并入实体]
B[一对多] ----> F[独立关系]

C[多对多] ----> F[独立关系]
```



# 关系代数

并(∪)、交(∩)、差(-)、笛卡尔积(×)、投影(π)、选择(σ)、连接(⋈)



# 规范化理论

## 候选键

将关系模式的函数依赖关系用“有向图”的方式表示

- 找入度为0的属性，并以该属性集合为起点，尝试遍历有向图，若能正常遍历图中所有结点，则该属性集即为关系模式的候选键
- 若入度为0的属性集不能遍历图中所有结点，则需要尝试性的将一些中间结点(既有入度，也有出度的结点)并入入度为0的属性集中，直至该集合能遍历所有结点，集合为候选键

**Armstrong公理**

- 自反律(Reflexivity) : 若Y∈X∈U，则X->Y成立。
- 增广律(Augmentation):若Z∈U且X->Y，则XZ->YZ成立
- 传递律(Transitivity):若X->Y且Y->Z，则X->Z成立。

根据A1，A2，A3这三条推理规则可以得到下面三条推理规则：

- 合并规则:由X->Y，X->Z，有X->YZ。 (A2，A3)
- 伪传递规则:由X->Y，WY->Z，有XW->Z。 (A2，A3)
- 分解规则:由X->Y及Z∈Y，有X->Z。 (A1，A3)



## 范式

部分依赖：A->C，AB->D，候选键是AB，A->C属于部份依赖。

- 第一范式 (1NF)

  在关系模式R中，当且仅当所有域只包含原子值，即每个属性都是**不可再分的数据项**，则称关系模式R是第一范式。

- 第二范式 (2NF)

    当且仅当实体E是第一范式 (1NF) ，且每一个非主属性完全依赖主键 (**不存在部分依赖**) 时，则称实体E是第二范式。

- 第三范式 (3NF)

    当且仅当实体E是第二范式 (2NF) ，且E中**没有非主属性传递依赖于码**时，则称实体E是第三范式。

- BC范式 (BCNF)

    设R是一个关系模式，F是它的依赖集，R属于BCNF当且仅当其F中每个依赖的决定因素**必定包含R的某个候选码**。



## 模式分解

- **保持函数依赖分解**

  设数据库模式ρ={R1，R2，··，Rk}是关系模式R的一个分解，F是R上的函数依赖集，ρ中每个模式Ri上的FD集是Fi。如果{F1, F2, ···, FK}与F是等价的 (即相互逻辑蕴涵)，那么称分解ρ保持FD。

  例：有关系模式R(A，B，C)，F= {A->B，B->C，A->C}，将其拆分为:R1 (A，B)，R2 (B，C) ，则保持函数依赖。

  

- **无损联接分解**：指将一个关系模式分解成若干个关系模式后，通过自然联接和投影等运算仍能还原到原来的关系模式

  **表格法**：出现同名属性列的才可以当主键，如R(A，B，C)，F= {A->B，A->C}，将其拆分为:R1 (A，B)，R2 (B，C) ，同名属性列是B，故而只能推导出B->A，B->C，此间关系不在{A->B，A->C}中，所以这样分解是有损联接分解。

  例：设R=ABC，F={A->B}，则分解ρ1={R1(AB)，R2(AC)}与分解ρ2{R1(AB)，R3(BC)是否都为无损分解?

  - ρ1同名列为A，R1(AB)满足A->B将B提上AC行得出ABC，故而ρ1是保持了函数依赖，并且是无损联接分解

  - ρ2同名列为B，B->A，B->C都不满足A->B，无法满足一行同时拥有ABC，ρ2是保持了函数依赖，可有损联接分解





































